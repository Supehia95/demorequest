<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Request Demo</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f6f9;
  padding:40px;
}

/* FORM */
.form-container{
  max-width:420px;
  margin:0 auto;
  background:#fff;
  padding:22px;
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.12);
}

input, select{
  width:100%;
  padding:11px;
  margin:12px 0;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:12px;
  background:#2d8cff;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
button:hover{ background:#1a6fd9; }

.loader{
  text-align:center;
  margin-top:15px;
  display:none;
}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  z-index:9999;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.65);
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:white;
  width:92%;
  max-width:1100px;
  height:85vh;
  border-radius:12px;
  position:relative;
  overflow:hidden;
  box-shadow:0 20px 50px rgba(0,0,0,0.35);
}

.close-btn{
  position:absolute;
  right:14px;
  top:10px;
  font-size:22px;
  cursor:pointer;
  font-weight:bold;
  z-index:10;
}

iframe{
  width:100%;
  height:100%;
  border:none;
}
</style>
</head>

<body>

<div class="form-container">
  <h3>Request Demo</h3>

  <form id="dummyForm">
    <input type="text" id="fname" placeholder="First Name" required>
    <input type="text" id="lname" placeholder="Last Name" required>
    <input type="email" id="email" placeholder="Email" required>

    <select id="country" required>
      <option value="">Select Country</option>
      <option value="India">India</option>
      <option value="USA">USA</option>
    </select>

    <button type="submit">Continue</button>
  </form>

  <div class="loader" id="loading">üîê Connecting securely...</div>
</div>

<!-- MODAL -->
<div class="modal" id="iframeModal">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <iframe id="targetFrame"></iframe>
  </div>
</div>

<script>
const SALESFORCE_ORIGIN = "https://tr1755503902062.my.site.com";
const BASE_BRIDGE = SALESFORCE_ORIGIN + "/customersupportchat/apex/demoRequestPage";

let bridgePopup = null;

/* FORM SUBMIT */
document.getElementById("dummyForm").addEventListener("submit", function(e){
  e.preventDefault();

  const country = document.getElementById("country").value;
  if(!country){
    alert("Please select country");
    return;
  }

  document.getElementById("loading").style.display="block";

  const bridgeUrl = BASE_BRIDGE + "?country=" + encodeURIComponent(country);

  bridgePopup = window.open(
    bridgeUrl,
    "sfBridge",
    "width=450,height=650,resizable=yes,scrollbars=yes"
  );
});

/* RECEIVE MESSAGE FROM SALESFORCE */
window.addEventListener("message", function(event){

  if(event.origin !== SALESFORCE_ORIGIN) return;
  if(!event.data || event.data.type !== "SET_IFRAME_URL") return;

  const dynamicUrl = event.data.url;

  if(bridgePopup && !bridgePopup.closed) bridgePopup.close();

  document.getElementById("loading").style.display="none";

  document.getElementById("targetFrame").src = dynamicUrl;
  document.getElementById("iframeModal").style.display="flex";
});

/* CLOSE MODAL */
document.getElementById("closeModal").onclick = () =>
  document.getElementById("iframeModal").style.display="none";

window.onclick = function(e){
  if(e.target === document.getElementById("iframeModal"))
    document.getElementById("iframeModal").style.display="none";
};
</script>

</body>
</html>
