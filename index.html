<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Embedded Request Flow</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f9;
  padding: 40px;
}

/* FORM */
.form-container {
  max-width: 420px;
  margin: 0 auto;
  background: #fff;
  padding: 22px;
  border-radius: 10px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
}

input {
  width: 100%;
  padding: 11px;
  margin: 12px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  padding: 12px;
  background: #2d8cff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
}

button:hover { background:#1a6fd9; }

/* IFRAME CONTAINER */
.viewer {
  display: none;
  margin-top: 30px;
}

iframe {
  width: 100%;
  height: 80vh;
  border: none;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}

/* LOADER */
.loader {
  display:none;
  text-align:center;
  font-size:18px;
  margin-top:20px;
}
</style>
</head>

<body>

<div class="form-container" id="formBox">
  <h3>Request Demo</h3>
  <form id="dummyForm">
    <input type="text" placeholder="First Name" required>
    <input type="text" placeholder="Last Name" required>
    <input type="email" placeholder="Email" required>
    <button type="submit">Continue</button>
  </form>
</div>

<div class="loader" id="loading">ðŸ”„ Connecting to secure service...</div>

<div class="viewer" id="viewerBox">
  <iframe id="targetFrame"></iframe>
</div>


<script>
const SALESFORCE_ORIGIN = "https://tr1755503902062.my.site.com";
const BRIDGE_URL = SALESFORCE_ORIGIN + "/customersupportchat/apex/demoRequestPage";

let bridgePopup = null;

/* ---------- FORM SUBMIT ---------- */
document.getElementById("dummyForm").addEventListener("submit", function(e){
    e.preventDefault();

    document.getElementById("loading").style.display = "block";

    bridgePopup = window.open(
        BRIDGE_URL,
        "sfBridge",
        "width=500,height=650,resizable=yes,scrollbars=yes"
    );
});


/* ---------- RECEIVE URL FROM SALESFORCE ---------- */
window.addEventListener("message", function(event){

    /* Security check */
    if(event.origin !== SALESFORCE_ORIGIN) return;

    if(!event.data || event.data.type !== "SET_IFRAME_URL") return;

    const dynamicUrl = event.data.url;

    console.log("Received secure URL:", dynamicUrl);

    /* Close popup if still open */
    if(bridgePopup && !bridgePopup.closed) bridgePopup.close();

    /* Hide form */
    document.getElementById("formBox").style.display = "none";
    document.getElementById("loading").style.display = "none";

    /* Load iframe */
    const frame = document.getElementById("targetFrame");
    frame.src = dynamicUrl;

    document.getElementById("viewerBox").style.display = "block";

});


/* Detect popup blocked */
setInterval(function(){
    if(bridgePopup && bridgePopup.closed){
        console.log("Bridge closed");
    }
},500);

</script>

</body>
</html>
