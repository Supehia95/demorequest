<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Request Demo</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f6f9;
  padding:40px;
}

/* FORM */
.form-container{
  max-width:420px;
  margin:0 auto;
  background:#fff;
  padding:22px;
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.12);
}

input,select{
  width:100%;
  padding:11px;
  margin:12px 0;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:12px;
  background:#2d8cff;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.loader{
  display:none;
  text-align:center;
  margin-top:15px;
  font-size:15px;
}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  z-index:9999;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.65);
  justify-content:center;
  align-items:center;
}

.modal-content{
  width:90%;
  max-width:1100px;
  height:85vh;
  background:white;
  border-radius:12px;
  overflow:hidden;
  position:relative;
  animation:fadeIn .25s ease;
}

@keyframes fadeIn{
  from{ transform:scale(.95); opacity:0;}
  to{ transform:scale(1); opacity:1;}
}

.close-btn{
  position:absolute;
  right:14px;
  top:10px;
  font-size:22px;
  cursor:pointer;
  z-index:10;
  font-weight:bold;
}

iframe{
  width:100%;
  height:100%;
  border:none;
}
</style>
</head>

<body>

<div class="form-container">
  <h3>Request Demo</h3>

  <form id="dummyForm">
    <input type="text" placeholder="First Name" required>
    <input type="text" placeholder="Last Name" required>
    <input type="email" placeholder="Email" required>

    <select id="country" required>
      <option value="">Select Country</option>
      <option value="India">India</option>
      <option value="USA">USA</option>
    </select>

    <button type="submit">Continue</button>
  </form>

  <div class="loader" id="loading">üîê Connecting securely...</div>
</div>

<!-- MODAL -->
<div class="modal" id="iframeModal">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <iframe id="targetFrame"></iframe>
  </div>
</div>

<script>
const SALESFORCE_ORIGIN = "https://tr1755503902062.my.site.com";
const BRIDGE_URL = SALESFORCE_ORIGIN + "/customersupportchat/apex/demoRequestPage";

let bridgeWindow = null;

/* BUTTON CLICK */
document.getElementById("dummyForm").addEventListener("submit", function(e){
  e.preventDefault();

  const country = document.getElementById("country").value;
  if(!country) return alert("Please select country");

  /* OPEN MODAL IMMEDIATELY */
  document.getElementById("iframeModal").style.display="flex";
  document.getElementById("targetFrame").src = "";
  document.getElementById("loading").style.display="block";

  /* SILENT BACKGROUND BRIDGE */
  bridgeWindow = window.open(
    BRIDGE_URL + "?country=" + encodeURIComponent(country),
    "bridge",
    "popup,width=1,height=1,left=-10000,top=-10000,noopener,noreferrer"
  );

  /* KEEP FOCUS ON PAGE */
  setTimeout(() => window.focus(), 50);
});


/* RECEIVE URL FROM SALESFORCE */
window.addEventListener("message", function(event){

  if(event.origin !== SALESFORCE_ORIGIN) return;
  if(!event.data || event.data.type !== "SET_IFRAME_URL") return;

  if(bridgeWindow && !bridgeWindow.closed) bridgeWindow.close();

  document.getElementById("loading").style.display="none";
  document.getElementById("targetFrame").src = event.data.url;

});


/* CLOSE MODAL */
document.getElementById("closeModal").onclick = () => {
  document.getElementById("iframeModal").style.display="none";
  document.getElementById("targetFrame").src="";
};
</script>

</body>
</html>
