<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Demo</title>

<style>
body{font-family:Arial;background:#f4f6f9;padding:40px}
.form-container{max-width:420px;margin:auto;background:#fff;padding:22px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,.12)}
input,select{width:100%;padding:11px;margin:12px 0;border-radius:6px;border:1px solid #ccc}
button{width:100%;padding:12px;background:#2d8cff;color:#fff;border:none;border-radius:6px;font-weight:bold}
.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.65);justify-content:center;align-items:center}
.modal-content{width:90%;max-width:1000px;height:85vh;background:#fff;border-radius:12px;overflow:hidden;position:relative}
.close-btn{position:absolute;right:12px;top:8px;font-size:22px;cursor:pointer;font-weight:bold}
iframe{width:100%;height:100%;border:none}
.loader{text-align:center;padding-top:40px;font-size:18px}
</style>
</head>

<body>

<div class="form-container">
  <h3>Book a Demo</h3>
  <form id="demoForm">
    <input type="text" placeholder="First Name" required>
    <input type="email" placeholder="Email" required>

    <select id="country" required>
      <option value="">Select Country</option>
      <option value="India">India</option>
      <option value="USA">USA</option>
    </select>

    <button type="submit">Schedule</button>
  </form>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close-btn" id="close">&times;</span>
    <div class="loader" id="loader">Connecting to scheduler...</div>
    <iframe id="schedulerFrame"></iframe>
  </div>
</div>

<script>
const SALESFORCE = "https://tr1755503902062.my.site.com";
const BRIDGE = SALESFORCE + "/customersupportchat/apex/demoRequestPage";

let bridgeWin=null;

document.getElementById("demoForm").addEventListener("submit", e=>{
  e.preventDefault();

  const country=document.getElementById("country").value;
  if(!country) return alert("Select country");

  // open modal immediately
  document.getElementById("modal").style.display="flex";
  document.getElementById("loader").style.display="block";
  document.getElementById("schedulerFrame").src="";

  // silent handshake
  bridgeWin=window.open(
    BRIDGE+"?country="+encodeURIComponent(country),
    "sfbridge",
    "width=1,height=1,left=-10000,top=-10000"
  );
});

window.addEventListener("message", e=>{
  if(e.origin!==SALESFORCE) return;
  if(!e.data || e.data.type!=="SCHEDULER_URL") return;

  if(bridgeWin && !bridgeWin.closed) bridgeWin.close();

  document.getElementById("loader").style.display="none";
  document.getElementById("schedulerFrame").src=e.data.url;
});

document.getElementById("close").onclick=()=>{
  document.getElementById("modal").style.display="none";
  document.getElementById("schedulerFrame").src="";
};
</script>

</body>
</html>
